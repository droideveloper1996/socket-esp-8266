<!-- <!DOCTYPE html>
<html lang="en">
  <head>
    
    <title>Dex Esp Socket</title>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <h2>ESP Socket test</h2>
        <div>
          <h4>Handshake Data From Esp When Connected</h4>
          <div class="alert alert-danger" id="from"></div>
          <div class="alert alert-info" id="data"></div>
        </div>
        <button class="btn btn-primary" id="refresh">
          Check Device Status
        </button>
        <button class="btn btn-primary" id="toggle">Toggle</button>
      </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>
    <script>
      const fromref = document.getElementById("from");
      const dataref = document.getElementById("data");
      const btn = document.getElementById("refresh");
      const toggle = document.getElementById("toggle");
      var action = true;
      btn.onclick = () => {
        window.location.reload();
      };

      const socket = io("http://13.232.193.81:4000/");
      socket.on("welcome", (data) => {
        console.log(data);
        socket.emit("acknowledge", {
          from: "esp",
          message: "I am connected to server",
        });
        fromref.innerText = data.from;
        dataref.innerText = data.data;
      });
      socket.on("disconnect", () => {
        console.log("Device Disconnected");
        fromref.innerText = "Device Disconnected";
        dataref.innerText = "";
      });

      toggle.onclick = () => {
        socket.emit("toggle", !action);
        action = !action;
      };

      socket.on("light", (data) => {
        alert(data);
        console.log("From Light Event", data);
      });
    </script>
  </body>
</html> -->

<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Latest compiled and minified CSS -->
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
      integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
      crossorigin="anonymous"
    />

    <!-- Optional theme -->
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
      integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp"
      crossorigin="anonymous"
    />

    <!-- Latest compiled and minified JavaScript -->
    <script
      src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
      integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
    <title>deX Esp Data Collection</title>
  </head>
  <body>
    <nav class="navbar navbar-default">
      <div class="container-fluid">
        <div class="navbar-header">
          <a class="navbar-brand" href="#">
            deX IoT
          </a>
        </div>
      </div>
    </nav>
    <div class="container">
      <div class="row">
        <div id="light" class="alert alert-success">Unknown</div>
        <h4>Trigger Actions</h4>

        <button class="btn btn-primary" id="basant">Basant</button>
        <button class="btn btn-alert" id="toggleButton">Toggle</button>

        <button class="btn btn-danger" id="clearLogs">
          Clear Server Logs
        </button>
      </div>
      <div class="row">
        <div class="col-sm-6">
          <canvas id="myChart1" width="400" height="400"></canvas>
          <canvas id="myChart2" width="400" height="400"></canvas>
        </div>
        <div class="col-sm-6">
          <div class="jumbotron">
            <h2>Data From Logs</h2>
            <div id="dataset"></div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>

    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
    <script>
      const btnBasant = document.getElementById("basant");
      var ctx1 = document.getElementById("myChart1").getContext("2d");
      var ctx2 = document.getElementById("myChart2").getContext("2d");
      const clearLogs = document.getElementById("clearLogs");
      const dataset = document.getElementById("dataset");
      const socket = io("http://13.232.193.81:3000/");
      $("#toggleButton").on("click", function () {
        socket.emit("toggle", { state: true });
      });
      socket.on("light", function (light) {
        console.log(light);
        if (light.state) {
          $("#light").text("ON");
        } else {
          $("#light").text("off");
        }
        const payload = {
          apiKey: "esp8266",
          temp: "40",
          humidity: "58",
        };
        btnBasant.onclick = () => {
          socket.emit("basant", payload);
        };
      });
      clearLogs.onclick = () => {
        socket.emit("clearLogs", { apiKey: "esp8266" });
      };

      var xLabel = [];
      var yLabel = [6, 7, 0];
      socket.on("track-live", (data) => {
        dataset.innerText = data;
        for (let i = 0; i < data.length; i++) {
          const item = JSON.parse(data[i]);
          xLabel[i] = parseInt(item.humidity);
          yLabel[i] = parseInt(item.temp);
        }
        drawChart(yLabel, ctx1, "Temperature");
        drawChart(xLabel, ctx2, "Humidity");
      });

      drawChart = (trainData, ctx, label) => {
        var myChart = new Chart(ctx, {
          type: "line",
          data: {
            labels: ["Red", "Blue", "Yellow", "Green", "Purple", "Orange"],
            datasets: [
              {
                label: label,
                data: trainData,
                backgroundColor: [
                  "rgba(255, 99, 132, 0.2)",
                  "rgba(54, 162, 235, 0.2)",
                  "rgba(255, 206, 86, 0.2)",
                  "rgba(75, 192, 192, 0.2)",
                  "rgba(153, 102, 255, 0.2)",
                  "rgba(255, 159, 64, 0.2)",
                ],
                borderColor: [
                  "rgba(255, 99, 132, 1)",
                  "rgba(54, 162, 235, 1)",
                  "rgba(255, 206, 86, 1)",
                  "rgba(75, 192, 192, 1)",
                  "rgba(153, 102, 255, 1)",
                  "rgba(255, 159, 64, 1)",
                ],
                borderWidth: 1.5,
              },
            ],
          },
          options: {
            scales: {
              yAxes: [
                {
                  ticks: {
                    beginAtZero: true,
                  },
                },
              ],
            },
          },
        });
      };
    </script>
  </body>
</html>
